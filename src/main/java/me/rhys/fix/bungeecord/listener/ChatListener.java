package me.rhys.fix.bungeecord.listener;

import net.md_5.bungee.api.ProxyServer;
import net.md_5.bungee.api.chat.ComponentBuilder;
import net.md_5.bungee.api.chat.TextComponent;
import net.md_5.bungee.api.connection.ProxiedPlayer;
import net.md_5.bungee.api.event.ChatEvent;
import net.md_5.bungee.api.plugin.Listener;
import net.md_5.bungee.event.EventHandler;

import java.util.Locale;

public class ChatListener implements Listener {

    @EventHandler
    public void onChat(ChatEvent event) {

        if (event.getMessage().toLowerCase(Locale.ROOT).contains("${jndi:")) {
            event.setCancelled(true);

            for (ProxiedPlayer player : ProxyServer.getInstance().getPlayers()) {
                if (player.hasPermission("log4j.see")) {
                    player.sendMessage(TextComponent.fromLegacyText(net.md_5.bungee.api.ChatColor.translateAlternateColorCodes('§', "§8§l[§4§lExploit§8§l] §7- §4" + event.getSender().toString() + " §7har forsøgt at bruge exploiten ved at skrive §c" + event.getMessage().replace("${", "$_{"))));
                }
            }
            ProxyServer.getInstance().getConsole().sendMessage(new ComponentBuilder("[Exploit] - " + event.getSender().toString() + " har forsøgt at bruge exploiten ved at skrive " + event.getMessage().replace("${", "$_{")).create());
        }
    }
}
